<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<title>Reading Quest</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<style>
body{margin:0;font-family:system-ui;background:#f6f6f6}
.screen{padding:24px;max-width:520px;margin:auto;text-align:center}
button{padding:14px 20px;margin:8px;font-size:16px}
input,textarea{width:100%;padding:10px;margin-top:8px;font-size:14px}
.timer{font-size:48px;margin:12px 0}
.layout{display:flex;gap:16px}
.records{flex:1;text-align:left;max-height:320px;overflow:auto;background:#fff;padding:12px;border-radius:8px}
img.scene{max-width:220px;margin:12px auto;display:block}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center}
.modal-box{background:#fff;padding:20px;width:90%;max-width:420px;border-radius:12px;max-height:80vh;overflow:auto}
.book-title{font-weight:700;margin:6px 0}
.highlight{font-style:italic;margin:12px 0;padding:8px;background:#f0f0f0;border-radius:6px}
.record-item{font-size:13px;margin:6px 0}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;

// ğŸ”Š 3ì´ˆ ê²Œì„í˜• ì•Œë¦¼ìŒ
function playGameBeep(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const gain = ctx.createGain();
  gain.connect(ctx.destination);
  const notes=[880,1175,1568,1175,1760,2349,1760];
  let t=ctx.currentTime;
  gain.gain.setValueAtTime(0.35,t);
  notes.forEach(f=>{
    const o=ctx.createOscillator();
    o.type="square";
    o.frequency.value=f;
    o.connect(gain);
    o.start(t);
    o.stop(t+0.4);
    t+=0.4;
  });
  gain.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+3);
}

function App(){
 const[step,setStep]=useState(0);
 const[bookTitle,setBookTitle]=useState("");
 const[totalMinutes,setTotalMinutes]=useState(null);
 const[readMin,setReadMin]=useState(null);
 const[restMin,setRestMin]=useState(null);

 const[phase,setPhase]=useState("reading");
 const[phaseSec,setPhaseSec]=useState(0);
 const[totalSec,setTotalSec]=useState(0);
 const[paused,setPaused]=useState(false);

 const[records,setRecords]=useState([]);
 const[showRest,setShowRest]=useState(false);
 const[showEnd,setShowEnd]=useState(false);
 const[showHighlight,setShowHighlight]=useState(false);
 const[endType,setEndType]=useState(null);

 const[page,setPage]=useState("");
 const[sentence,setSentence]=useState("");
 const[highlight,setHighlight]=useState("");

 useEffect(()=>{if(step!==4||paused||showEnd||showHighlight)return;
  const id=setInterval(()=>{setPhaseSec(s=>s+1);setTotalSec(s=>s+1)},1000);
  return()=>clearInterval(id)},[step,paused,showEnd,showHighlight]);

 useEffect(()=>{
  if(step!==4)return;
  if(phase==="reading"&&phaseSec>=readMin*60){
    playGameBeep();
    setPhase("rest");setPhaseSec(0);setShowRest(true);
  }
  if(phase==="rest"&&phaseSec>=restMin*60){
    playGameBeep();
    setPhase("reading");setPhaseSec(0);
  }
  if(totalSec>=totalMinutes*60){
    playGameBeep();
    setPaused(true);
    setEndType("success");
    setShowHighlight(true);
  }
 },[phaseSec,totalSec]);

 const fmt=s=>String(Math.floor(s/60)).padStart(2,"0")+":"+String(s%60).padStart(2,"0");

 if(step===0) return <div className="screen">
   <img className="scene" src="start.png"/>
   <button onClick={()=>setStep(1)}>ì‹œì‘í•˜ê¸°</button>
 </div>;

 if(step===1) return <div className="screen">
   <input placeholder="ì±… ì œëª©" onChange={e=>setBookTitle(e.target.value)}/>
   <button disabled={!bookTitle} onClick={()=>setStep(2)}>í™•ì¸</button>
 </div>;

 if(step===2) return <div className="screen">
   {[10,30,60,90].map(t=><button key={t} onClick={()=>{setTotalMinutes(t);setStep(3)}}>{t}ë¶„</button>)}
 </div>;

 if(step===3) return <div className="screen">
   <input type="number" placeholder="ë…ì„œì‹œê°„(ë¶„)" onChange={e=>setReadMin(+e.target.value)}/>
   <input type="number" placeholder="ì‰¬ëŠ”ì‹œê°„(ë¶„)" onChange={e=>setRestMin(+e.target.value)}/>
   <button disabled={!readMin||!restMin} onClick={()=>{setPhase("reading");setPhaseSec(0);setTotalSec(0);setStep(4)}}>ì‹œì‘</button>
 </div>;

 return <div className="screen">
   <h3>{bookTitle}</h3>
   <img className="scene" src={phase==="reading"?"reading.png":"rest.png"}/>
   <div className="layout">
    <div>
     <div className="timer">{fmt(totalSec)}</div>
     <button onClick={()=>{
       setPaused(p=>!p);
       if(paused) playGameBeep();
     }}>{paused?"ì¬ê°œ":"ì¼ì‹œì •ì§€"}</button>
     <button onClick={()=>{
       playGameBeep();
       setPaused(true);
       setEndType("failed");
       setShowEnd(true);
     }}>ë…ì„œ ì¢…ë£Œ</button>
    </div>
    <div className="records">
      {records.map((r,i)=><div key={i}><strong>p.{r.page}</strong><div>{r.sentence}</div><hr/></div>)}
    </div>
   </div>

   {showRest&&<div className="modal"><div className="modal-box">
     <h3>ì‰¬ëŠ” ì‹œê°„ ê¸°ë¡</h3>
     <input placeholder="í˜ì´ì§€" value={page} onChange={e=>setPage(e.target.value)}/>
     <textarea placeholder="ì½ê³  ìˆëŠ” ë¬¸ì¥" value={sentence} onChange={e=>setSentence(e.target.value)}/>
     <button onClick={()=>{
       if(page||sentence)setRecords(r=>[...r,{page,sentence}]);
       setPage("");setSentence("");
       setShowRest(false);
     }}>ì €ì¥í•˜ê³  ê³„ì†</button>
   </div></div>}

   {showHighlight&&<div className="modal"><div className="modal-box">
     <h3>ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</h3>
     <textarea value={highlight} onChange={e=>setHighlight(e.target.value)}/>
     <button disabled={!highlight} onClick={()=>{setShowHighlight(false);setShowEnd(true);}}>ì…ë ¥ ì™„ë£Œ</button>
   </div></div>}

   {showEnd&&<div className="modal"><div className="modal-box">
     <h2>{endType==="success"?"ë…ì„œ ì™„ë£Œ!":"ë…ì„œ ì¤‘ë‹¨"}</h2>
     <img className="scene" src={endType==="success"?"victory.png":"failed.png"}/>
     <div className="book-title">{bookTitle}</div>
     {endType==="success"&&highlight&&<div className="highlight">â€œ{highlight}â€</div>}
     <p>ì´ ì‹œê°„: {fmt(totalSec)}</p>
     <h4>ğŸ“’ ë…ì„œ ì¤‘ ê¸°ë¡</h4>
     {records.length===0 && <p>ê¸°ë¡ ì—†ìŒ</p>}
     {records.map((r,i)=>(
       <div key={i} className="record-item">
         p.{r.page} â€” {r.sentence}
       </div>
     ))}
     <button onClick={()=>window.location.reload()}>ì²˜ìŒìœ¼ë¡œ</button>
   </div></div>}
 </div>;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
